<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bank Service</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; }
        .navbar { display: flex; align-items: center; gap: 40px; background-color: #003366; padding: 16px 24px; }
        .navbar a { color: white; text-decoration: none; font-size: 16px; font-weight: bold; }
        .navbar a:hover { text-decoration: underline; }
        .right-box { margin-left: auto; color: white; text-align: right; }
        .logout-btn { background: none; border: 1px solid white; color: white; padding: 4px 8px; cursor: pointer; margin-top: 6px; }
        .content { padding: 40px; text-align: center; }
    </style>
</head>
<body>

<div class="navbar">
    <a th:href="@{/account}">조회</a>
    <a th:href="@{/transfer}">이체</a>
    <a th:href="@{/support}">고객센터</a>
    <a th:href="@{/about}">은행소개</a>

    <!-- 로그인 상태 -->
    <div class="right-box" th:if="${userName != null}">
        <div th:text="${userName} + '님 안녕하세요'" style="font-weight:bold;"></div>
        <div id="timer" style="font-size:13px; margin-top:4px;">
            로그인 유지시간 00분 00초
        </div>
        <form th:action="@{/api/auth/logout}" method="post">
            <button type="submit" class="logout-btn">로그아웃</button>
        </form>
    </div>

    <!-- 비로그인 상태 -->
    <div class="right-box" th:unless="${userName != null}">
        <a th:href="@{/login}">로그인</a>
    </div>
</div>

<div class="content">
    <h1>환영합니다</h1>
    <p>Bank Service 홈 화면입니다.</p>
</div>

<script th:inline="javascript">
    /* 서버에서 전달받은 expiresIn (초 단위) 사용 */
    let remainingSeconds = /*[[${expiresIn}]]*/ 0;

    function logout() {
        fetch('/api/auth/logout', { method: 'POST', credentials: 'include' })
            .finally(() => location.href = '/login');
    }

    function updateTimer() {
        if (remainingSeconds <= 0) {
            document.getElementById("timer").innerText = "로그인이 만료되었습니다";
            logout();
            return;
        }
        const m = Math.floor(remainingSeconds / 60);
        const s = remainingSeconds % 60;
        document.getElementById("timer").innerText =
            `로그인 유지시간 ${String(m).padStart(2,'0')}분 ${String(s).padStart(2,'0')}초`;
        remainingSeconds--;
    }

    if (remainingSeconds > 0) {
        updateTimer();
        setInterval(updateTimer, 1000);
    }
</script>

</body>
</html>
